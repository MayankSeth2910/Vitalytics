<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Liver Assessment - VITALYTICS</title>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --primary:hsl(187,72%,35%);--primary-light:hsl(187,72%,45%);
  --bg:hsl(200,20%,98%);--card:#fff;--text:hsl(210,20%,15%);
  --muted:hsl(210,10%,45%);--border:hsl(210,15%,90%);
  --destructive:hsl(0,72%,51%);--success:hsl(142,60%,40%);
  --warning:hsl(38,92%,50%);--radius:12px;
  --shadow:0 1px 3px rgba(0,0,0,.06),0 4px 12px rgba(0,0,0,.04);
}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text)}
a{text-decoration:none;color:inherit}
.navbar{position:sticky;top:0;z-index:100;background:rgba(255,255,255,.85);backdrop-filter:blur(12px);border-bottom:1px solid var(--border)}
.navbar .container{max-width:1200px;margin:0 auto;padding:0 1.5rem;display:flex;align-items:center;justify-content:space-between;height:64px}
.logo{font-size:1.4rem;font-weight:700;color:var(--primary)}
.nav-links{display:flex;gap:2rem;list-style:none}
.nav-links a{font-size:.9rem;font-weight:500;color:var(--muted)}
.nav-links a.active{color:var(--primary)}
.hero{background:linear-gradient(135deg,hsl(187,72%,95%),hsl(187,72%,90%));border-bottom:1px solid var(--border);padding:3rem 1.5rem;text-align:center}
.hero h1{font-size:2rem;font-weight:700;margin-bottom:.5rem}
.hero p{color:var(--muted)}
.form-section{max-width:900px;margin:2rem auto;padding:0 1.5rem}
.form-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem 2rem;margin-bottom:1.5rem;box-shadow:var(--shadow)}
.section-header{display:flex;align-items:center;gap:.75rem;margin-bottom:1.5rem}
.section-icon{width:40px;height:40px;border-radius:10px;background:hsl(187,72%,92%);display:flex;align-items:center;justify-content:center}
.form-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1.25rem}
.form-group{display:flex;flex-direction:column;gap:.35rem}
.form-group label{font-size:.85rem;font-weight:600}
.req{color:var(--destructive)}
.form-group input,.form-group select{height:40px;border:1px solid var(--border);border-radius:8px;padding:0 .75rem;font-size:.9rem}
.submit-wrap{text-align:center;margin-bottom:2rem}
.btn-primary{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 3rem;background:var(--primary);color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer}
.btn-primary:disabled{opacity:.6;cursor:not-allowed}
.spinner{width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;display:none}
@keyframes spin{to{transform:rotate(360deg)}}
.disclaimer{display:flex;gap:.75rem;align-items:flex-start;background:hsl(210,15%,96%);border:1px solid var(--border);border-radius:var(--radius);padding:1rem 1.25rem;margin-bottom:1.5rem}
.disclaimer svg{flex-shrink:0;width:20px;height:20px;stroke:var(--muted);margin-top:2px}
.disclaimer p{font-size:.85rem;color:var(--muted)}
/* RESULT CARD */
.result-card{display:none;background:var(--card);border:2px solid var(--border);border-radius:var(--radius);padding:2rem;margin-bottom:1.5rem;text-align:center;box-shadow:var(--shadow)}
.result-card.positive{border-color:var(--destructive)}
.result-card.negative{border-color:var(--success)}
.result-badge{display:inline-block;padding:.5rem 1.5rem;border-radius:999px;font-size:1.1rem;font-weight:700;margin-bottom:1rem}
.result-badge.positive{background:hsl(0,72%,95%);color:var(--destructive)}
.result-badge.negative{background:hsl(142,60%,95%);color:var(--success)}
.conf-bar-wrap{margin:1rem auto;max-width:300px}
.conf-label{font-size:.85rem;color:var(--muted);margin-bottom:.4rem}
.conf-bar{height:10px;background:var(--border);border-radius:999px;overflow:hidden}
.conf-fill{height:100%;background:var(--primary);border-radius:999px;transition:width .8s ease}
/* FEEDBACK POPUP */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:200;align-items:center;justify-content:center}
.overlay.open{display:flex}
.popup{background:var(--card);border-radius:var(--radius);padding:2rem;max-width:420px;width:90%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,.15)}
.popup h3{font-size:1.25rem;font-weight:600;margin-bottom:.75rem}
.popup p{color:var(--muted);margin-bottom:1.5rem;font-size:.95rem}
.popup-btns{display:flex;gap:1rem;justify-content:center}
.btn-yes{padding:.6rem 2rem;background:var(--success);color:#fff;border:none;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer}
.btn-no{padding:.6rem 2rem;background:var(--destructive);color:#fff;border:none;border-radius:8px;font-size:.95rem;font-weight:600;cursor:pointer}
.btn-skip{margin-top:.75rem;background:none;border:none;color:var(--muted);font-size:.85rem;cursor:pointer;text-decoration:underline}
footer{border-top:1px solid var(--border);background:rgba(0,0,0,.85);color:#aaa;padding:2rem 1.5rem;text-align:center;font-size:.8rem}
</style>
</head>
<body>

<nav class="navbar">
  <div class="container">
    <a href="index.html" class="logo">VITALYTICS</a>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="assesment.html" class="active">Assessment</a></li>
      <li><a href="descript.html">How It Works</a></li>
    </ul>
  </div>
</nav>

<section class="hero">
  <h1>ü´Ä Liver Disease Prediction</h1>
  <p>Enter biochemical markers and clinical indicators for liver health evaluation.</p>
</section>

<div class="form-section">

  <!-- RESULT CARD -->
  <div class="result-card" id="resultCard">
    <div class="result-badge" id="resultBadge"></div>
    <p id="resultMsg" style="color:var(--muted);font-size:.95rem;margin-bottom:1rem"></p>
    <div class="conf-bar-wrap">
      <div class="conf-label" id="confLabel"></div>
      <div class="conf-bar"><div class="conf-fill" id="confFill" style="width:0%"></div></div>
    </div>
  </div>

  <form id="liverForm">

    <div class="form-card">
      <div class="section-header"><div class="section-icon">üë§</div><h2>Patient Info</h2></div>
      <div class="form-grid">
        <div class="form-group"><label>Age <span class="req">*</span></label><input type="number" id="age" min="1" max="120" required></div>
        <div class="form-group"><label>Gender <span class="req">*</span></label>
          <select id="gender" required><option value="">Select</option><option>Male</option><option>Female</option></select></div>
      </div>
    </div>

    <div class="form-card">
      <div class="section-header"><div class="section-icon">üß™</div><h2>Bilirubin Levels</h2></div>
      <div class="form-grid">
        <div class="form-group"><label>Total Bilirubin (mg/dL) <span class="req">*</span></label><input type="number" id="total_bilirubin" step="0.1" min="0" required></div>
        <div class="form-group"><label>Direct Bilirubin (mg/dL) <span class="req">*</span></label><input type="number" id="direct_bilirubin" step="0.1" min="0" required></div>
      </div>
    </div>

    <div class="form-card">
      <div class="section-header"><div class="section-icon">‚öóÔ∏è</div><h2>Enzyme Levels</h2></div>
      <div class="form-grid">
        <div class="form-group"><label>Alkaline Phosphotase (U/L) <span class="req">*</span></label><input type="number" id="alkphos" step="1" min="0" required></div>
        <div class="form-group"><label>SGPT / ALT (U/L) <span class="req">*</span></label><input type="number" id="sgpt" step="1" min="0" required></div>
        <div class="form-group"><label>SGOT / AST (U/L) <span class="req">*</span></label><input type="number" id="sgot" step="1" min="0" required></div>
      </div>
    </div>

    <div class="form-card">
      <div class="section-header"><div class="section-icon">üî¨</div><h2>Protein Markers</h2></div>
      <div class="form-grid">
        <div class="form-group"><label>Total Proteins (g/dL) <span class="req">*</span></label><input type="number" id="total_proteins" step="0.1" min="0" required></div>
        <div class="form-group"><label>Albumin (g/dL) <span class="req">*</span></label><input type="number" id="albumin" step="0.1" min="0" required></div>
        <div class="form-group"><label>A/G Ratio <span class="req">*</span></label><input type="number" id="ag_ratio" step="0.01" min="0" required></div>
      </div>
    </div>

    <div class="submit-wrap">
      <button type="submit" class="btn-primary" id="submitBtn">
        Analyze Liver Health
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
        <div class="spinner" id="spinner"></div>
      </button>
    </div>

    <div class="disclaimer">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M12 2a10 10 0 100 20 10 10 0 000-20z"/></svg>
      <p>This tool is for educational and screening purposes only. Always consult a healthcare professional for medical advice.</p>
    </div>
  </form>
</div>

<!-- FEEDBACK POPUP -->
<div class="overlay" id="overlay">
  <div class="popup">
    <h3>Was this diagnosis accurate?</h3>
    <p>Your feedback helps us improve the model. Do you agree with the prediction?</p>
    <div class="popup-btns">
      <button class="btn-yes" id="btnYes">‚úÖ Yes, Correct</button>
      <button class="btn-no"  id="btnNo">‚ùå No, Incorrect</button>
    </div>
    <br>
    <button class="btn-skip" id="btnSkip">Skip feedback</button>
  </div>
</div>

<footer><p>¬© 2026 VITALYTICS. Educational purposes only. Not a substitute for medical advice.</p></footer>

<script>
const API = '';  // same-origin; if different host: 'https://your-backend.com'
let lastResult = null;

document.getElementById('liverForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const btn = document.getElementById('submitBtn');
  const spin = document.getElementById('spinner');
  btn.disabled = true; spin.style.display = 'block';

  const payload = {
    age:              document.getElementById('age').value,
    gender:           document.getElementById('gender').value,
    total_bilirubin:  document.getElementById('total_bilirubin').value,
    direct_bilirubin: document.getElementById('direct_bilirubin').value,
    alkphos:          document.getElementById('alkphos').value,
    sgpt:             document.getElementById('sgpt').value,
    sgot:             document.getElementById('sgot').value,
    total_proteins:   document.getElementById('total_proteins').value,
    albumin:          document.getElementById('albumin').value,
    ag_ratio:         document.getElementById('ag_ratio').value,
  };

  try {
    const res  = await fetch(`${API}/predict/liver`, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (data.error) throw new Error(data.error);

    lastResult = data;
    showResult(data);
    // Show feedback popup after short delay
    setTimeout(() => document.getElementById('overlay').classList.add('open'), 1500);
  } catch (err) {
    alert('Error: ' + err.message);
  } finally {
    btn.disabled = false; spin.style.display = 'none';
  }
});

function showResult(data) {
  const card  = document.getElementById('resultCard');
  const badge = document.getElementById('resultBadge');
  const msg   = document.getElementById('resultMsg');
  const fill  = document.getElementById('confFill');
  const lbl   = document.getElementById('confLabel');

  const isPos = data.prediction.includes('DISEASE');
  card.style.display = 'block';
  card.className = 'result-card ' + (isPos ? 'positive' : 'negative');
  badge.className = 'result-badge ' + (isPos ? 'positive' : 'negative');
  badge.textContent = data.prediction;

  msg.textContent = isPos
    ? 'Indicators suggest possible liver disease. Please consult a hepatologist.'
    : 'No significant liver disease indicators detected.';

  if (data.confidence_pct != null) {
    lbl.textContent = `Model confidence: ${data.confidence_pct}%`;
    fill.style.width = data.confidence_pct + '%';
  }
  card.scrollIntoView({ behavior:'smooth', block:'center' });
}

async function sendFeedback(val) {
  if (!lastResult) return;
  document.getElementById('overlay').classList.remove('open');
  try {
    await fetch(`${API}/feedback`, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ id: lastResult.id, tab: lastResult.tab, feedback: val })
    });
  } catch(e) { console.warn('Feedback error', e); }
}

document.getElementById('btnYes').onclick  = () => sendFeedback('yes');
document.getElementById('btnNo').onclick   = () => sendFeedback('no');
document.getElementById('btnSkip').onclick = () => document.getElementById('overlay').classList.remove('open');
</script>
</body>
</html>
